Ubuntu Server: 192.168.1.88 (Bridged)

sudo apt update

sudo apt upgrade


Instalación de Bind9:

sudo apt install bind9

sudo apt install nginx

Instalación de un Certificado Interno (Genérico):

sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/matelat.key -out /etc/ssl/certs/matelat.pem

Después de Configurar el Sitio en sites-avalaible:

Se copia default al sitio con nuestro nombre.

cp default fp.conf

Se Crea el Directorio del Sitio en:

/var/wwww

Hay que Hacer Disponible el Sitio Creando un Enlace Simbólico Desde el Directorio sites-available al Directorio sites-enabled: 

sudo ln -s /etc/nginx/sites-available/fp.conf /etc/nginx/sites-enabled/fp.conf

Para Instalar vsftpd (El Servicio de FTP)

sudo apt install vsftpd

$sudo nano /etc/vsftpd.conf
Comprobar la siguiente configuración (llegado el caso descomentar la línea write_enable=YES):

anonymous_enable=NO
local_enable=YES
write_enable=YES

salvar, salir y reiniciar el servicio:

sudo systemctl restart vsftpd

Hay que loguearse desde otro Equipo en la misma red con:

ftp ip.del.otro.equipo

para salir quit

Para habilitar seguridad TLS/SSL:

Tenindo el certificado ya agregado:

sudo nano /etc/vsftpd.conf

se agregan las siguiente líneas:

rsa_cert_file=/etc/ssl/certs/matelat.pem
rsa_private_key_file=/etc/ssl/private/matelat.key
ssl_enable=YES

Se usa el nombre del cetificado que creamos antes.

Hay que denegar las conexiones anonimas:

allow_anon_ssl=NO
force_local_data_ssl=YES
force_local_logins_ssl=YES

Y se configura el servidor para usar TLS:

ssl_tlsv1=YES
ssl_sslv2=NO
ssl_sslv3=NO

sudo systemctl restart vsftpd

Para hacer pruebas creo un usuario de pruebas llamado prueba:

adduser prueba

Pide todos los Datos.

Se ha creado el usuario y su Directorio de trabajo.

Para configurar Apache2 o Nginx para 443 (https):

SSLEngine On 
SSLCertificateFile /etc/ssl/certs/matelat.pem 
SSLCertificateKeyFile /etc/ssl/private/matelat.key

Se Agrega el certificado al fichero de configuración del sitio.

El fichero se ve así:

<VirtualHost *:443>

ServerName www.sitio.edu
ServerAdmin cesar@localhost
DocumentRoot /var/www/sitio
<Directory /var/www/sitio>
AllowOverride All
Directory Index index.html
</Directory>
<Directory /var/www/sitio/privado>
AllowOverride AuthConfig
Directory Index private.html
</Directory>
SSLEngine On
SSLCertificateFile /etc/ssl/certs/matelat.pem
SSLCertificateKeyFile /etc/ssl/private/matelat.key

ErrorLog ${APACHE_LOG_DIR}/error.log
CustomLog ${APACHE_LOG_DIR}/access.log combined

</VirtualHost>